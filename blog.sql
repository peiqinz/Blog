/*
SQLyog Ultimate v10.00 Beta1
MySQL - 5.7.12-log : Database - blog
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`blog` /*!40100 DEFAULT CHARACTER SET utf8 */;

USE `blog`;

/*Table structure for table `category` */

DROP TABLE IF EXISTS `category`;

CREATE TABLE `category` (
  `cid` int(11) NOT NULL AUTO_INCREMENT,
  `CNAME` varchar(255) DEFAULT NULL,
  `CPHOTO` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`cid`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;

/*Data for the table `category` */

insert  into `category`(`cid`,`CNAME`,`CPHOTO`) values (1,'移动开发',NULL),(2,'Web前端',NULL),(3,'架构设计',NULL),(4,'编程语言',NULL),(5,'互联网',NULL),(6,'数据库',NULL),(7,'系统运维',NULL),(8,'云计算',NULL);

/*Table structure for table `fileinfo` */

DROP TABLE IF EXISTS `fileinfo`;

CREATE TABLE `fileinfo` (
  `FID` int(11) NOT NULL AUTO_INCREMENT,
  `FNAME` varchar(255) DEFAULT NULL,
  `uid` int(11) DEFAULT NULL,
  `FPLACE` varchar(255) DEFAULT NULL,
  `DTIME` int(11) DEFAULT NULL,
  `CONTENTTYPE` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`FID`),
  KEY `FK_3svuwgygkn7od8uriyvqu3xa0` (`uid`),
  CONSTRAINT `FK_3svuwgygkn7od8uriyvqu3xa0` FOREIGN KEY (`uid`) REFERENCES `user` (`uid`)
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8;

/*Data for the table `fileinfo` */

insert  into `fileinfo`(`FID`,`FNAME`,`uid`,`FPLACE`,`DTIME`,`CONTENTTYPE`) values (5,'blog.png',3,'File\\admin\\blog.png',0,NULL),(9,'Java.docx',3,'File\\admin\\Java.docx',0,NULL),(10,'common.gif',3,'File\\admin\\common.gif',0,NULL),(11,'u=15169923,773420854&fm=21&gp=0.jpg',3,'File\\admin\\u=15169923,773420854&fm=21&gp=0.jpg',0,NULL),(12,'_]3Z_TG))N41LXFS4C5IW`G.jpg',3,'File\\admin\\_]3Z_TG))N41LXFS4C5IW`G.jpg',0,NULL),(13,'2016111601.xls',3,'File\\admin\\2016111601.xls',0,NULL),(14,'index.html',3,'File\\admin\\index.html',0,NULL),(15,'_]3Z_TG))N41LXFS4C5IW`G.jpg',3,'File\\admin\\_]3Z_TG))N41LXFS4C5IW`G.jpg',0,NULL),(16,'blog.png',3,'\\File\\admin\\blog.png',0,NULL),(17,'common.gif',3,'\\File\\admin\\common.gif',0,'image/gif'),(18,'Java.docx',3,'File\\admin\\Java.docx',0,'application/vnd.openxmlformats-officedocument.wordprocessingml.document'),(19,'blog.png',3,'File\\admin\\blog.png',0,NULL);

/*Table structure for table `post` */

DROP TABLE IF EXISTS `post`;

CREATE TABLE `post` (
  `pid` int(11) NOT NULL AUTO_INCREMENT,
  `cid` int(11) DEFAULT NULL,
  `uid` int(11) DEFAULT NULL,
  `TITLE` varchar(255) DEFAULT NULL,
  `CONTAINER` mediumtext,
  `POSTDAY` varchar(255) DEFAULT NULL,
  `SUMMARY` varchar(255) DEFAULT NULL,
  `VIEW` int(255) DEFAULT NULL,
  PRIMARY KEY (`pid`),
  KEY `FK_vw0lpuhwnei373w2b7t1sfff` (`cid`),
  KEY `FK_58lrovirplonwa5berjtc5vr4` (`uid`),
  CONSTRAINT `FK_58lrovirplonwa5berjtc5vr4` FOREIGN KEY (`uid`) REFERENCES `user` (`uid`),
  CONSTRAINT `FK_vw0lpuhwnei373w2b7t1sfff` FOREIGN KEY (`cid`) REFERENCES `category` (`cid`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;

/*Data for the table `post` */

insert  into `post`(`pid`,`cid`,`uid`,`TITLE`,`CONTAINER`,`POSTDAY`,`SUMMARY`,`VIEW`) values (1,3,3,'Java int和integer的区别','<p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">int是基本类型(Primitive),Integer是引用类型(Warpper).<br/>int是<a href=\"http://lib.csdn.net/base/17\" class=\"replace_word\" title=\"Java EE知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration: none; font-weight: bold;\">Java</a>的原始数据类型,Integer是java为int提供的封装类.</p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">int的变量不需要实例化,Interger的变量需要实例化.<br/>int的默认值为0,Integer的默认值为null.<br/>int一般做数值参数,Integer一般做类型转换.</p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">int a = 5；<br/>Integer b = 5；<br/>a你只能用来做计算.<br/>b你可以用来做很多事,因为它是一个对象,他有很多静态方法.</p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">Map的key与value,List与Set的element若要保存数值信息都要把int包装成Integer对象使用.</p><p style=\"color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">在JSP开发中,Integer的默认值为null,所以用el表达式在文本框中显示时,值为空白字符串.而int的默认值为0,所以用el表达式在文本框中显示时,结果为0.所以,int不适合作为web层的表单数据的类型.</p><p><br/></p>','2016-11-15',NULL,92),(2,6,3,'理解性能的奥秘——应用程序中慢，SSMS中快（2）——SQL Server如何编译存储过程','<p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"white-space: pre;\">	</span>本文介绍SQL Server如何编译存储过程并使用计划缓存。如果你的应用程序完全没有用到存储过程，而是直接使用SQL语句提交请求，那么本文大部分内容也是有效的。但是关于动态SQL的编译会在后面章节介绍，这里重点关注让人头痛的存储过程问题。</p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><br/></p><h1 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>什么是存储过程？</h1><p><span style=\"white-space: pre;\">	</span>虽然这个问题有点愚蠢，但是实际的问题是：什么对象有自己的查询计划？SQL Server为下面四类对象创建查询计划：</p><ol class=\" list-paddingleft-2\"><li><p>存储过程。</p></li><li><p>标量用户自定义函数。</p></li><li><p>多步表值函数。</p></li><li><p>触发器</p></li></ol><p><span style=\"white-space: pre;\">	</span>这里使用一个更加通用和严谨的技术术语“模组（modules）”来标识，但是由于存储过程的极其广泛的使用，所以这里还是保留原有称呼。</p><p><span style=\"white-space: pre;\">	</span>除了上面列举的四类对象之外，SQL Server不创建查询计划。特别是对视图和内联表值函数（inline-table functions），SQL Server并不创建查询计划，比如：</p><p><span style=\"white-space: pre;\"></span></p><pre style=\"white-space: pre-wrap; word-wrap: break-word; margin-left: 18pt;\">SELECT&nbsp;abc,&nbsp;def&nbsp;FROM&nbsp;myview\nSELECT&nbsp;a,&nbsp;b,&nbsp;c&nbsp;FROM&nbsp;mytablefunc(9)</pre><p><span style=\"white-space: pre;\">	</span>它们跟直接使用即席查询（ad-hoc queries）访问基础表没有什么区别。在编译这些查询时，SQL Server会把视图/函数展开成实际语句，并基于这些实际语句进行优化。</p><p><span style=\"white-space: pre;\">	</span>关于存储过程的结构，如果类似下面写法，那么意味着你实际上有两个过程，外层调用内层：</p><pre style=\"white-space: pre-wrap; word-wrap: break-word; margin-left: 18pt;\">CREATE&nbsp;PROCECURE&nbsp;Outer_sp&nbsp;AS\n...\nEXEC&nbsp;Inner_sp\n...</pre><p><br/></p><p><span style=\"white-space: pre;\">	</span>我猜大部分人会觉得Inner_sp和Outer_sp是独立的，确实如此。Outer_sp的执行计划并不包含Inner_sp，仅仅是调用它而已。但是有一个很类似的写法：</p><pre style=\"white-space: pre-wrap; word-wrap: break-word; margin-left: 18pt;\">CREATE&nbsp;PROCEDURE&nbsp;Some_sp&nbsp;AS\nDECLARE&nbsp;@sql&nbsp;&nbsp;&nbsp;&nbsp;nvarchar(MAX),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@params&nbsp;nvarchar(MAX)\nSELECT&nbsp;@sql&nbsp;=&nbsp;&#39;SELECT&nbsp;...&#39;\n...\nEXEC&nbsp;sp_executesql&nbsp;@sql,&nbsp;@params,&nbsp;@par1,&nbsp;...</pre><p><br/></p><p><span style=\"white-space: pre;\">	</span>需要知道的是，这种写法与嵌套存储过程没有区别。产生的SQL字符串“不”属于“Some_sp”，也不出现在Some_sp执行计划中的任何部分，但是它有一个关于自己的查询计划和缓存条目（cache entry）。这种方式适合于使用EXEC()执行的动态SQL或者使用sp_executesql执行的动态SQL语句。</p><h2 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>SQL Server如何生成查询计划：</h2><h3 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>概述：</h3><p>&nbsp; &nbsp; &nbsp; &nbsp; 当你输入以CREATE PROCEDURE（或者CREATE FUNCTION、CREATE TRIGGER同理）的存储过程时，SQL Server会先判断代码语法是否正确，同时也会检查是否使用了不存在的列（但是如果你使用了不存在的表，编译依旧会通过，因为这里使用了一个叫推迟命名解析（deferred named resolution）的功能）。但是在这个阶段，SQL Server并不创建任何查询计划，而是仅存储查询文本在数据库中。&nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; 直到执行存储过程时，SQL Server才会对其创建执行计划。对于每个语句，SQL Server会从统计信息中查找针对这个查询，在对应表中的数据分布情况。通过这个信息得到关于执行这个语句的最佳预估方式，这个过程成为“优化（optimisation）”。当存储过程被编译一次之后，每个语句都被独自优化，并且不会分析后续步骤。这就衍生出一个很重要的 特性：优化器对运行时传入的变量毫不知晓。但是对于存储过程传入的参数，优化器是可以知道的。</p><h3 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a><span style=\"white-space: pre;\">参数和变量：</span></h3><p><span style=\"white-space: pre;\">	现在看看在Northwind库中的这三个存储过程：</span></p><p><span style=\"white-space: pre;\"><br/></span></p><p><span style=\"white-space: pre;\"></span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_1&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;20000101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_2&nbsp;@fromdate&nbsp;DATETIME&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_3&nbsp;@fromdate&nbsp;DATETIME&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DECLARE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate_copy&nbsp;DATETIME&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate_copy&nbsp;=&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate_copy&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li></ol><p><span style=\"white-space: pre;\">--------------------------------------------------------------------------------------------------------------------------- </span></p><address style=\"color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"white-space: pre;\"><span style=\"color: rgb(255, 0, 0);\">注意，在生产环境中使用SELECT *并不是什么好的习惯。这里只是为了演示起见。</span></span></address><p><span style=\"white-space: pre;\">--------------------------------------------------------------------------------------------------------------------------- <br/></span></p><p><span style=\"white-space: pre;\">接下来按下面方式执行存储过程，并使用“包含实际执行计划”（或Ctrl+M再执行），语句及结果如下：</span></p><p><span style=\"white-space: pre;\"><br/></span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_1&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_2&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;20000101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_3&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;20000101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li></ol><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178623187087196.png\" alt=\"\"/></p><p>&nbsp; &nbsp; &nbsp; &nbsp; 前两个存储过程的执行计划如上图“查询2”所示，使用了索引查找操作，而第三个存储过程使用的是聚集索引扫描操作，如上图“查询3”所示。此时SQL Server进行了全表扫描（注意，聚集索引的叶节点存储了数据本身，索引聚集索引扫描和表扫描是一样的），为什么会发生这种情况呢？为了明白优化器的决定，一般做法是检查影响的预估行数，如果把鼠标移到查找和扫描两个操作符上，可以看到下面两个结果：</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178623235087729.png\" alt=\"\"/></p><p>查询1</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178623338091740.png\" alt=\"\"/></p><p>查询2</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178623441029440.png\" alt=\"\"/></p><p>查询3</p><p><span style=\"white-space: pre;\">	</span>其中值得关注的是“<span style=\"white-space: pre;\">预估影响行数</span>”（Estimated Number of Rows）。对于前两个存储过程，SQL Server预估只会返回1行数据，但是对于第三个存储过程，预估返回249行。这个差异导致了优化器选择不同的执行计划。对于一个表返回少量数据而言，索引查找+键值查找（Key Lookup）是很好的策略，但是对于相对较大规模的返回结果而言，开销就会增加，此时SQL Server底层更愿意使用直接扫描一次全表来降低开销。对于返回表的大部分甚至全部行而言，表扫描/聚集索引扫描会更加高效。因为此时SQL Server只需要访问一次表数据，而查找加键值查找，数据页中的每一行都会触发一次访问。在Northwind数据库中的Orders表，有830行数据，而SQL Server预估要返回249行，所以它觉得扫描是最佳选择。</p><h3 style=\"margin: 0px; padding: 0px; white-space: pre;\"><a style=\"color: rgb(12, 137, 207);\"></a>预估数据的出处？</h3><p><span style=\"white-space: pre;\">	</span>前面说了为什么会出现不同的执行计划：因为预估数量的不同。但是这又仅仅引出了下一个问题：为什么会不同呢？这也是本系列的关键点之一。对于第一个存储过程，日期是常量，意味着SQL Server只需要考虑这个值的情况。通过查询Orders表的统计信息，即可知道预估行数。但是统计信息毕竟是表的取样数据，所以SQL Server不能确定查询是否有数据返回，所以它认为只返回1行数据。对于第二个存储过程，查询使用了一个变量，更准确地说是一个参数。当优化器进行优化时，SQL Server知道这个存储过程会传入2000-01-01这个值。但是并不知道后续操作，所以它也不确定后续是否真的会用这个参数值。尽管如此，优化器根据输入值计算出对应的预估行数，也和第一个存储过程一样，只有1行，这种策略叫做参数嗅探（parameter sniffing）。对于第三个存储过程，就有所不同了，输入值被复制到一个本地变量，但是在SQL Server产生执行计划时，它真不知道这个值最终会是怎么样子的，所以使用一个标准假设，也就是假设会有30%的命中率，830行的30%就是249行。针对这种情况，有一个变种情景，如下面的第四个存储过程：</p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_4&nbsp;@fromdate&nbsp;DATETIME&nbsp;=&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">IF&nbsp;@fromdate&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">IS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate&nbsp;=&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;19900101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li></ol><p><br/><span style=\"white-space: pre;\">	</span>在这个存储过程中，参数是可选的，如果不传参数，默认就是null，即返回所有订单数，也就是等价于EXEC List_orders_4，它的执行计划和第一、第二个存储过程一样。使用索引查找+键值查找，尽管返回所有订单数据。如果你查看索引查找操作符的属性，可以看到除了“实际影响行数”（actual number of rows）之外其他都和第二个存储过程一样。在编译这个存储过程时，SQL Server并不知道@fromdate值的改变，假设@fromdate值为NULL。因为在关系数据库中，NULL代表着“未知”，也就是说，如果@fromdate在运行过程中依旧是这个值的话，查询可能返回任意数据。如果SQL Server把这值作为最后的输入，那么它会构造一个只有常量的扫描操作而完全不需要访问表（可以使用SELECT * FROM Orders WHERE OrderDate &gt; NULL&nbsp;来检验）。但是SQL Server又不得不生成一个满足不管@fromdate在运行时传入什么值都能返回正确结果的执行计划。另外一方面，SQL Server没有义务创建一个对所有值都是最佳的执行计划，所以它假设没有任意值返回，SQL Server因此决定使用索引查找。（但是依旧是返回1行，因为SQL Server永远不会使用0行作为预估行数）这是一个关于参数嗅探的反效果的例子，在实践中，更加合理的方式已更改是改写成下面第五个存储过程的样子：</p><p>	</p><p><strong>[sql]</strong> <a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a> <a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a> <a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_5&nbsp;@fromdate&nbsp;DATETIME&nbsp;=&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DECLARE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate_copy&nbsp;DATETIME&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate_copy&nbsp;=&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">coalesce</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(@fromdate,&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;19900101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate_copy&nbsp;&nbsp;</span></span></p></li></ol><p>	如果你执行这个存储过程，会看到这次使用了聚集索引扫描操作。</p><h3 style=\"margin: 0px; padding: 0px; white-space: pre;\"><a style=\"color: rgb(12, 137, 207);\"></a>关键点：</h3><p>	在本节中，提到了以下一些关键内容：</p><ul class=\" list-paddingleft-2\"><li><p>当一个查询包含一个常量时，SQL Server会完全信任这个常量，如果它从约束中推断出不会返回任何数据，甚至可以使用短路模式不访问底层表。</p></li><li><p>对于参数，SQL Server并不知道运行时的具体值，但是会在编译过程中“嗅探”输入值。</p></li><li><p>对于本地变量，SQL Server对此一无所知，所以使用标准假设。（这个假设依赖于语句的操作符和从唯一索引中推导出来的信息）</p></li><span style=\"white-space: pre;\">	</span><span style=\"color: rgb(255, 0, 0);\">从中我们得出一个结论：如果你从一个存储过程中提取一个查询，并使用一个常量替换变量和参数，你可能实际上得到了一个不同的查询，这一点在后续小节介绍。</span></ul><p><span style=\"white-space: pre;\"><br/></span></p><h2 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a><span style=\"white-space: pre;\">把查询计划放入缓存：</span></h2><p><span style=\"white-space: pre;\"><br/></span></p><p><span style=\"white-space: pre;\">	</span>如果每一次存储过程被执行时，SQL Server都要编译（也就是优化和产生查询计划），那么对于SQL Server来说，会因为所有CPU资源被耗尽而带来巨大危机。但是实际上并不是所有系统都这样，因为这个并不适合所有系统。在大型的数据仓库里面，通常会有几百个复杂查询的、可能需要分钟级别才能运行完的查询在执行，这些即使每次都编译，也不会带来什么危险，反而有好处。但是对于有大量用于在短时间内执行大量存储过程的OLTP系统，这个问题就变得很现实了。</p><p><span style=\"white-space: pre;\">	</span>基于这个原因，SQL Server缓存存储过程的查询计划，以便下一次用户执行它的时候，能跳过编译阶段，然后直接执行。这个计划会驻留在缓存中，直到某些事件导致计划被移出缓存。常见的事件有：</p><ul class=\" list-paddingleft-2\"><li><p><span style=\"white-space: pre;\">SQL Server 的缓冲池（buffer cache)已满，SQL Server需要把“过时”的内容清除出去。这个缓存池通常包含了数据和查询计划。</span></p></li><li><p><span style=\"white-space: pre;\">执行了ALTER PROC/PROCEDURE命令。</span></p></li><li><p><span style=\"white-space: pre;\">执行了对存储过程的sp_recompile命令。</span></p></li><li><p><span style=\"white-space: pre;\">执行了DBCC FREEPROCCACHE命令。</span></p></li><li><p><span style=\"white-space: pre;\">SQL Server重启，因为缓冲池是存储在内存中，重启会清空内存。</span></p></li><li><p><span style=\"white-space: pre;\">使用sp_configure或SSMS修改了某些影响查询计划的配置参数。</span></p></li></ul><p><span style=\"white-space: pre;\">	</span>一旦上面提到的事件被触发，在下一次执行存储过程的时候，新的查询计划就会被编译、优化然后创建。SQL Server重新“嗅探”参数的输入，如果这时候的参数值和之前的不同，那么查询计划也可能和之前的不同（意味着性能会有差异甚至巨大差异）。</p><p><span style=\"white-space: pre;\">	</span>但是也有一些时间不会影响整个存储过程的计划缓存，但是会触发存储过程内部某些语句的重编译。在下一次执行时，重编译就会触发。这种情况下就算存储过程已经开始执行也可能触发。常见的有：</p><ul class=\" list-paddingleft-2\"><li><p><span style=\"white-space: pre;\">语句中涉及的表定义被修改。</span></p></li><li><p><span style=\"white-space: pre;\">语句中涉及的表上的索引变更，包含使用ALTER INDEX或DBCC DBREINDEX重建索引。</span></p></li><li><p><span style=\"white-space: pre;\">语句涉及的表的统计信息更新或新建统计信息。这些统计信息可能被SQL Server自动创建和更新，也可能被DBA操作。</span></p></li><li><p><span style=\"white-space: pre;\">语句涉及的表被执行了sp_recompile。</span></p></li></ul><p><span style=\"white-space: pre;\">	提醒：SQL Server 2000中没有语句级别的重编译，只有整个存储过程的重编译。</span></p><p><span style=\"white-space: pre;\">	</span></p><p><span style=\"white-space: pre;\">	</span>上面列举的并不是完整的列表，但是应该注意到其中一个没提到的点:同一个存储过程不同参数的情况.也就是说,比如调用第二个存储过程:</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_2&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;19900101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	</span>执行计划依旧使用OrderDate上的索引,尽管返回所有的订单数据.这个现象表明一个很重要的事实:存储过程首次执行时的参数值对后续的执行有非常大的影响.如果因为某些原因,第一次执行时的值非常不典型,那么对于后续的执行来说,缓存的查询计划可能并不合理,所以参数嗅探才会变得如此的重要.</p><h2 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>不同设置的查询计划:</h2><p><span style=\"white-space: pre;\">	</span>在缓存中,一个存储过程有一个查询计划是不是意味着所有人都可以用它?其实不是,本节介绍关于缓存中同一个存储过程也可能有多个查询计划.为了演示需要,下面构造一个特制的存储过程:</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_6&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;12/01/1998&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;DATEFORMAT&nbsp;dmy&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_6&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;DATEFORMAT&nbsp;mdy&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_6&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li></ol><p><span style=\"white-space: pre;\">	</span></p><p><span style=\"white-space: pre;\">	</span>按上面方式,打开实际执行计划并运行,会发现第一个返回很多数据,而第二个没有数据.检查执行计划可以发现也完全不同.第一个执行使用了聚集索引扫描（对于返回大量数据来说是最佳方式），而第二个执行使用了索引查找+键值查找（对于没数据返回时是最佳方式）。</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178624290063379.png\" alt=\"\"/></p><p><span style=\"white-space: pre;\">	</span>那么发生了什么事？是不是因为SET DATEFORMAT触发了重编译？不是，如果是这样就太不聪明了。在这个例子里面，执行是一个接一个地进行，但是也可以在由不同的用户使用不同的日期格式并行提交。注意存储过程的计划缓存并不绑定到特定会话或用户，但是全局来说是允许所有已连接的用户使用。</p><p><span style=\"white-space: pre;\">	</span>答案是SQL Server针对第二个存储过程的执行创建了第二个缓存条目。可以使用下面查询查看：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;qs.plan_handle,&nbsp;a.attrlist&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;&nbsp;sys.dm_exec_query_stats&nbsp;qs&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">CROSS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;APPLY&nbsp;sys.dm_exec_sql_text(qs.sql_handle)&nbsp;est&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">CROSS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;APPLY&nbsp;(</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;epa.attribute&nbsp;+&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;=&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">convert</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(nvarchar(127),&nbsp;epa.value)&nbsp;+&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;&nbsp;&nbsp;&nbsp;&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;&nbsp;sys.dm_exec_plan_attributes(qs.plan_handle)&nbsp;epa&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;epa.is_cache_key&nbsp;=&nbsp;1&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ORDER</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">BY</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;epa.attribute&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FOR</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;XML&nbsp;PATH(</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">))&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;a(attrlist)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;est.objectid&nbsp;=&nbsp;object_id&nbsp;(</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;dbo.List_orders_6&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">AND</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;est.dbid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;db_id(</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;Northwind&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	</span>里面的DMV sys.dm_exec_query_stats分别针对当前每个查询记录一个计划缓存条目。如果存储过程有多个语句，那么会每个语句对应一行。这里比较需要注意的是sql_handle和plan_handle列，sql_handle用于确定缓存条目中是关于那个存储过程的，所以可以通过它去筛选掉其他 缓存中不相干的条目。同时可以使用plan_handle去查找查询计划。但是这个语句中查询查询计划的属性（cache keys），属性里面很多信息是相同的，这里挑出不同的展示，这个cache key是一个实际运行时的设置，可以显示出不同调用时的设置，里面大部分设置由SET命令控制，但是不是全部都这样。去掉不必要的信息之后，在我本机的结果如下：<span style=\"white-space: pre;\">	</span></p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[plain]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\" class=\" list-paddingleft-2\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">plan_handle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attrlist&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">-------------------------------------------------------------------------------------------&nbsp;--------------------------------------------------&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">0x05000D009D13BF5E30DF8F550300000001000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;compat_level=120&nbsp;&nbsp;&nbsp;date_first=7&nbsp;&nbsp;&nbsp;date_format=2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">0x05000D009D13BF5ED0678F590300000001000000000000000000000000000000000000000000000000000000&nbsp;&nbsp;compat_level=120&nbsp;&nbsp;&nbsp;date_first=7&nbsp;&nbsp;&nbsp;date_format=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	</span>具体的说明可以查阅联机丛书：<a target=\"_blank\" href=\"https://msdn.microsoft.com/zh-cn/library/ms189472.aspx\" style=\"text-decoration: none; color: rgb(12, 137, 207);\">https://msdn.microsoft.com/zh-cn/library/ms189472.aspx</a>&nbsp;，正如前面说的，这个存储过程是特制的，用于说明为什么查询计划会不同：不同的日期格式导致了不同的结果，又比如下面的调用方式：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;sp_recompile&nbsp;List_orders_2&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;DATEFORMAT&nbsp;dmy&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_2&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;12/01/1998&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;DATEFORMAT&nbsp;mdy&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_2&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;12/01/1998&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li></ol><p><br/><span style=\"white-space: pre;\">	</span>第一句sp_recompile是为了刷掉旧的计划缓存确保对演示没有影响。这一次，参数值是一样的，但是由于日期格式不一样，所以第一个查询实际上是使用了1998-01-12而第二个查询实际上使用了1998-12-01。</p><p><span style=\"white-space: pre;\">	</span>cache key中非常重要的值是set_options。这是一个位掩码，标识一系列SET选项是否开启。如果两个连接使用了不同的SET选项，那么同一个存储过程就会使用不同的缓存条目，从而导致不同的执行计划，最终出现不同的性能差异。</p><p><span style=\"white-space: pre;\">	</span>其中一个转换SET_OPTIONS成可识别的值的方式是：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">convert</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">binary</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(4),&nbsp;4347)&nbsp;&nbsp;</span></span></p></li></ol><p><span style=\"white-space: pre;\">	</span><br/></p><h2 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a><span style=\"white-space: pre;\">默认设置：</span></h2><p><span style=\"white-space: pre;\">	</span>SQL Server的默认值具有一定的历史遗留问题，时至今日一些默认值还是依赖于客户端的连接方式，部分值的明细如下：</p><table width=\"900\" style=\"width: 876px;\"><tbody><tr class=\"firstRow\"><td><br/></td><td>使用ADO.NET/ODBC/OLE DB的应用程序</td><td>SSMS/查询分析器</td><td>SQLCMD/OSQL/BCP/SQL Agent</td><td>ISQL/DB-Library</td></tr><tr><td>ANSI_NULL_DFLT_ON</td><td>ON</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td></tr><tr><td>ANSI_NULLS</td><td>ON</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td></tr><tr><td>ANSI_PADDING</td><td>ON</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td></tr><tr><td>ANSI_WARNING</td><td>ON</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td></tr><tr><td>CONCATE_NULLS_YIELD_NULL</td><td>ON</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td></tr><tr><td>QUOTED_IDENTIFIER</td><td>ON</td><td>ON</td><td><strong>OFF</strong></td><td><strong>OFF</strong></td></tr><tr><td>ARITHABORT</td><td><strong>OFF</strong></td><td>ON</td><td><strong>OFF</strong></td><td><strong>OFF</strong></td></tr></tbody></table><p><br/><span style=\"white-space: pre;\">	</span>上面可以看到，如果你用应用程序连接SQL Server，那么ARITHABORT是OFF的，但是使用SSMS连接，却是ON，所以应用程序和SSMS执行的同一个存储过程也使用不同的缓存条目，但是SQL Server也会编译存储过程，嗅探当前参数值，然后得到可能和应用调用的存储过程不同的查询计划。那么现在差不多可以回答一开始的问题了。后续章节会做更加深入的探讨，但是最常见的关于“在应用程序中很慢，在SSMS中很快”的原因是参数嗅探和不同的ARITHABORT默认值。<br/></p><p><span style=\"white-space: pre;\">	</span>对于SET选项，并不总是在运行时才会使用，当你创建一个存储过程、视图、表等等时，ANSI_NULLS和QUOTED_IDENTIFIER设置都会记录在对象中。也就是说如果你按下面方式运行:</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;ANSI_NULLS,&nbsp;QUOTED_IDENTIFIER&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">OFF</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">go&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;stupid&nbsp;@x&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">int</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">IF&nbsp;@x&nbsp;=&nbsp;<span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;PRINT&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;@x&nbsp;is&nbsp;NULL&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">go&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SET</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;ANSI_NULLS,&nbsp;QUOTED_IDENTIFIER&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">go&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;stupid&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li></ol><p>结果将是： @x is NULL</p><p><span style=\"white-space: pre;\">	</span>当QUOTED_IDENTIFIER为OFF时，双引号（“）被认为和单引号（&#39;）等价。当设为ON时，双引号被认为和中括号（[]）一样。另外，ANSI_PADDING是针对表上的每个列单独存储（数据类型为varchar/nvarchar/varbinary）。</p><p><span style=\"white-space: pre;\">	</span>这些选项和不同的默认值确实让人困惑，但还是有一些建议可用：</p><ol class=\" list-paddingleft-2\"><li><p>记得上面表格中的前六个是仅仅为了向后兼容，所以建议设为OFF。虽然不是强制，但是通常而言，设为OFF很少会有问题。</p></li><li><p>对于ARITHABORT，在SQL 2005及其后续版本中，ANSI_WARNING是否为ON也不对其有任何影响。在SSMS中，可以通过设置来修改。但是这回在使用SSMS连接SQL Server时改变ARITHABORT的默认设置，并且不能让你的应用跑得更快，但是最起码你不会因为在SSMS中得到不同的性能而感到困惑。</p></li></ol><p><span style=\"white-space: pre;\">	</span>作为提醒，下面几个ANSI页的选项应该如下图所示，强烈 建议“<span style=\"color: rgb(255, 0, 0);\">不要修改</span>”</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178625340013899.png\" alt=\"\"/><br/></p><p><span style=\"white-space: pre;\">	</span>当使用SQLCMD和OSQL连接时，应该总是带上-I选项，让工具运行在“QUOTED_IDENTIFIER ON”下。相对的BCP参数为-q。但是对于SQL Agent而言就稍微麻烦一点。目前为止还没有找到对应的修改。所以如果你仅在SQL Agent中运行存储过程，问题不大，只需要把对应的SET命令写入存储过程中即可。但是如果你在SQL Agent要实现松散的批处理语句，你很可能因为QUOTED_IDENTIFER的不同默认值导致不同的执行计划。对于这类语句，建议在SQL Agent作业的第一步总带上SET QUOTED_IDENTIFIER ON。</p><p><span style=\"white-space: pre;\">	</span>前面看到了SET DATEFORMAT带来的影响，除了这个之外还有两个选项：LANGUAGE和DATEFIRST。默认语言是基于每个用户配置的，并且由服务器范围的配置来控制新用户的默认语言。如果每个用户的默认语言不同，则在cache keys中可能得到不同的查询计划。</p><p><span style=\"white-space: pre;\">	</span><span style=\"color: rgb(255, 0, 0);\">对此我的建议是尽可能避免在SQL Server中存在独立于语言和日期设置。比如，总是使用统一的日期格式。</span></p><h2 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>语句重编译的效果：</h2><p><span style=\"white-space: pre;\">	</span>为了完整地了解SQL Server如何产生查询计划，我们必须研究独立的语句在重编译时是怎样的。前面提到过什么时候会触发语句级别的重编译，但是当时没有做深入研究。下面看一个人为特制的存储过程，但是它能很好地演示发生了什么：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_7&nbsp;@fromdate&nbsp;DATETIME,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;@ix&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">BIT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate&nbsp;=&nbsp;dateadd(</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">YEAR</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;2,&nbsp;@fromdate)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">IF&nbsp;@ix&nbsp;=&nbsp;1&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;(ShipVia)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_7&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;19980101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;</span></p></li></ol><p><span style=\"white-space: pre;\">	</span>实际执行计划如下：</p><p><span style=\"white-space: pre;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178625604030953.png\" alt=\"\"/><br/></span></p><p><span style=\"white-space: pre;\">	</span></p><p><span style=\"white-space: pre;\">	</span>查看实际执行计划可以看到第一个SELECT语句使用了聚集索引扫描，因为SQL Server嗅探到值为“1998-01-01”并且预估查询会返回267行数据，使用索引查找+键值查找会过高开销，所以允许使用聚集索引扫描。但是SQL Server不知道@fromdate的值在下一个查询时会改变。而由于第二个语句在执行之前出现了CREATE INDEX语句，触发了第二个语句的重编译，从而使优化器重新优化第二个语句，在得知预估行数只有1行时，查询适合使用索引查找+键值查找操作。当出现语句重编译时，SQL Server重新嗅探当前参数值，并编译出一个更佳的查询计划。</p><p><span style=\"white-space: pre;\">	</span>重新执行存储过程，但是使用不同的参数：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_7&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;19960101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;0&nbsp;&nbsp;</span></span></p></li></ol><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178625874064132.png\" alt=\"\"/></p><p><span style=\"white-space: pre;\">	</span>实际执行计划和第一次执行一样，在第二次执行中，第一个语句因为新加的索引导致了重编译，但是这次使用扫描操作是合理的，因为这次查找的是接近1/3的订单数据。但是现在第二个语句不再重编译了。虽然此时不是最佳的查询计划，但是它依旧使用上次执行的索引查找作为执行计划。</p><p><span style=\"white-space: pre;\">	</span>为了避免对后续的影响，我们需要清空演示时的效果：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_7&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	正如一开始说的，这个存储过程是人为的，因为我希望以简洁的方式演示。在现实环境中，你的存储过程可能对不同的表使用相同的参数。DBA们会对其中一个表创建一个新索引，以触发这个表的重编译，而另外一个查询就不会。这里的关键点是：存储过程中的两个语句，可能由于嗅探不同的参数值而编译得出不同的查询计划。</span></p><p><span style=\"white-space: pre;\">	当看到这里，我们可以把思维扩展到本地变量中：</span></p><p><span style=\"white-space: pre;\">	</span></p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_8&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DECLARE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate&nbsp;DATETIME&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@fromdate&nbsp;=&nbsp;</span><span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;20000101&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;(ShipVia)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderDate&nbsp;&gt;&nbsp;@fromdate&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_8&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_8&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	</span>执行计划如下：</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178626307083868.png\" alt=\"\"/><br/></p><p><span style=\"white-space: pre;\">	</span>在这个例子中，所有SELECT语句都使用了聚集索引扫描，虽然第二个SELECT因为@fromdate的不可知而发生了重编译。但是也有例外，就是表变量。通常SQL Server对表变量的预估永远是1行，但是当重编译发生时，预估就不一样了：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_9&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DECLARE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">TABLE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(a&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NOT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PRIMARY</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">KEY</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INSERT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;(a)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderID&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">COUNT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(*)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;O&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;EXISTS&nbsp;(&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;i&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;O.OrderID&nbsp;=&nbsp;i.a&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;(ShipVia)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">COUNT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(*)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;O&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;EXISTS&nbsp;(&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;i&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;O.OrderID&nbsp;=&nbsp;i.a&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INDEX</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;test&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">ON</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_9&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_9&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><span style=\"white-space: pre;\">	</span>执行计划及预估行数如下：</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178626559086396.png\" alt=\"\"/><br/></p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178626643079819.png\" alt=\"\"/></p><p>表变量重编译之前的预估行数</p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178626727027728.png\" alt=\"\"/><br/></p><p>表变量重编译之后的预估行数</p><p><span style=\"white-space: pre;\">	</span>在第一个SELECT中，使用了<span style=\"color: rgb(255, 0, 0);\">嵌套循环联接</span>关联Order表的聚集索引“<span style=\"color: rgb(255, 0, 0);\">查找</span>”和表变量的聚集索引，表变量的预估行数为1，符合常规。在第二个SELECT中，Order表上使用了聚集索引“<span style=\"color: rgb(255, 0, 0);\">扫描</span>”，并使用<span style=\"color: rgb(255, 0, 0);\">合并联接</span>操作符与表变量关联，从图中可以看到表变量的预估行数变成了830行，因为这次触发了重编译，SQL Server嗅探出表变量上面的基数。</p><p><span style=\"white-space: pre;\">	</span>在某些情况下它就类似于参数嗅探。我（作者）曾经经历过一次在系统中一个关键存储过程突然建变慢，通过检查发现语句中的表变量预估行数为41，不幸的是，这个存储过程在每天运行中都是一个接一个地运行，所以预估1行会更加合理。</p><p><span style=\"white-space: pre;\">	</span>说到表变量，你可能会好奇从SQL 2008引入的“表值”参数。它们类似表变量的方式处理，但是是在作为参数时已被处理而不是在存储过程中被处理，所以SQL Server会按照超过1行的预估数量来编译优化，下面是例子：</p><p><span style=\"white-space: pre;\">	</span></p><p><strong>[sql]</strong>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">copy</a>&nbsp;<a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"PrintSource\" title=\"print\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">print</a><a href=\"http://blog.csdn.net/dba_huangzj/article/details/53067436#\" class=\"About\" title=\"?\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\">?</a><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"/ueditor/jsp/upload/image/20161115/1479178622860099283.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/1985327/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 0px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-sql list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">USE&nbsp;Northwind&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;TYPE&nbsp;temptype&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">TABLE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(a&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NOT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"op\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(128, 128, 128); background-color: inherit;\">NULL</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PRIMARY</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">KEY</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">CREATE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_10&nbsp;@ids&nbsp;temptype&nbsp;READONLY&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">AS</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"func\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(255, 20, 147); background-color: inherit;\">COUNT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">(*)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;O&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;EXISTS&nbsp;(&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;*&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;i&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">WHERE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;O.OrderID&nbsp;=&nbsp;i.a&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DECLARE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;temptype&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">INSERT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;@ids&nbsp;(a)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">SELECT</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;OrderID&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">FROM</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Orders&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">EXEC</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_10&nbsp;@ids&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">GO&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">PROCEDURE</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;List_orders_10&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">DROP</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;TYPE&nbsp;temptype&nbsp;&nbsp;</span></span></p></li></ol><p><br/></p><p><img src=\"/ueditor/jsp/upload/image/20161115/1479178626983059292.png\" alt=\"\"/><br/></p><p><span style=\"white-space: pre;\">	</span>查询计划和List_orders_9的第二个SELECT一样，使用合并联接+Orders表的聚集索引扫描，同时可以看到在查询被编译时，是按830行预估行数进行。</p><h1 style=\"margin: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(12, 137, 207);\"></a>小结：</h1><p><span style=\"white-space: pre;\">	</span>在本文中，我们看到了SQL Server如何编译一个存储过程和实际参数值对编译的影响。我们也知道了SQL Server把查询计划放入缓存，以便后续被重用。另外也演示了在缓存中的同一个存储过程可以有多个条目。多个不同缓存键会导致同一个存储过程存在不同查询计划的潜在风险。最后就是某些影响缓存键的SET配置是历史遗留配置，不应该改动。</p><p><span style=\"white-space: pre;\">	</span>在实际应用中，最重要的SET选项是ARITHABORT，因为在应用程序和SSMS中，该选项的默认值是不同的。这也是为什么你的语句在应用程序中慢但是在SSMS中能运行良好的原因之一。应用程序使用了计划因为参数的实际值不同而被嗅探成不同的查询计划，而当你在SSMS中运行语句是，很可能没有ARITHABORT ON 的计划在计划缓存中，所以SQL Server会对当前参数值创建查询计划。因此，你可以通过在SSMS的执行界面中加上SET ARITHABORT OFF命令来验证这个问题。</p><p><span style=\"white-space: pre;\">	</span>而且极有可能你现在在应用程序中执行的慢查询在SSMS中也一样很慢，如果发生这种情况，你就可能是遇到了参数嗅探的情况。你可能还不知道怎么处理这种性能问题，但是在下一节我会讨论解决方案，然后回到之前的主题，对特定查询，也就是动态SQL的讨论。</p><p><br/></p>','2016-11-15','	本文介绍SQL Server如何编译存储过程并使用计划缓存。如果你的应用程序完全没有用到存储过程，而是直接使用SQL语句提交请求，那么本文大部分内容也是有效的。但是关于动态SQL的编译会在后面章节介..',18),(3,6,2,'内存映射文件原理探索','<p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">首先说说这篇文章要解决什么问题?&nbsp;<br/>1.虚拟内存与内存映射文件的区别与联系.&nbsp;<br/>2.内存映射文件的原理.&nbsp;<br/>3.内存映射文件的效率.&nbsp;<br/>4.传统IO和内存映射效率对比.</p><h3 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>虚拟内存与内存映射文件的区别与联系</h3><h4 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>　二者的联系</h4><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">虚拟内存和内存映射文件都是将一部分内容加载到,另一部分放在磁盘上的一种机制,二者都是应用程序动态性的基础,由于二者的虚拟性,对于用户都是透明的.&nbsp;<br/>虚拟内存其实就是硬盘的一部分,是计算机RAM与硬盘的数据交换区,因为实际的物理内存可能远小于进程的地址空间，这就需要把内存中暂时不用到的数据放到硬盘上一个特殊的地方，当请求的数据不在内存中时，系统产生却页中断，内存管理器便将对应的内存页重新从硬盘调入物理内存。&nbsp;<br/>内存映射文件是由一个文件到一块内存的映射，使应用程序可以通过内存指针对磁盘上的文件进行访问，其过程就如同对加载了文件的内存的访问，因此内存文件映射非常适合于用来管理大文件。</p><h4 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>二者的区别</h4><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">1.虚拟内存使用硬盘只能是页面文件，而内存映射使用的磁盘部分可以是任何磁盘文件.&nbsp;<br/>2.二者的<a href=\"http://lib.csdn.net/base/16\" class=\"replace_word\" title=\"大型网站架构知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration: none; box-sizing: border-box; font-weight: bold;\">架构</a>不同,或者是说应用的场景不同,虚拟内存是架构在物理内存之上,其引入是因为实际的物理内存运行程序所需的空间，即使现在计算机中的物理内存越来越大，程序的尺寸也在增长。将所有运行着的程序全部加载到内存中不经济也非常不现实。内存映射文件架构在程序的地址空间之上，32位机地址空间只有4G，而某些大文件的尺寸可要要远超出这个值，因此，用地址空间中的某段应用文件中的一部分可解决处理大文件的问题，在32中，使用内存映射文件可以处理2的64次（64EB）大小的文件.原因内存映射文件，除了处理大文件，还可用作进程间通信。</p><h3 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>内存映射文件的原理</h3><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">“映射”就是建立一种对应关系,在这里主要是指硬盘上文件的位置与进程逻辑地址空间中一块相同区域之间一一对应,这种关系纯属是逻辑上的概念，物理上是不存在的，原因是进程的逻辑地址空间本身就是不存在的,在内存映射过程中,并没有实际的数据拷贝,文件没有被载入内存,只是逻辑上放入了内存,具体到代码,就是建立并初始化了相关的<a href=\"http://lib.csdn.net/base/31\" class=\"replace_word\" title=\"算法与数据结构知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration: none; box-sizing: border-box; font-weight: bold;\">数据结构</a>,这个过程有系统调用mmap()实现,所以映射的效率很高.</p><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><img src=\"/ueditor/jsp/upload/image/20161127/1480261204308051608.gif\" alt=\"这里写图片描述\" title=\"\"/>&nbsp;<br/>　　　　　　　　　　　　　　　　　　　　　内存映射原理&nbsp;<br/>上面说到建立内存映射没有进行实际的数据拷贝,那么进行进程又怎么能最终通过内存操作访问到硬盘上的文件呢?&nbsp;<br/>看上图:&nbsp;<br/>1.调用mmap(),相当于要给进行内存映射的文件分配了虚拟内存,它会返回一个指针ptr,这个ptr所指向的是一个逻辑地址,要操作其中的数据,必须通过MMU将逻辑地址转换成物理地址，如图1中过程2所示。&nbsp;<br/>2.建立内存映射并没有实际拷贝数据，这时，MMU在地址映射表中是无法找到与ptr相对应的物理地址的，也就是MMU失败，将产生一个缺页中断，缺 页中断的中断响应函数会在swap中寻找相对应的页面，如果找不到（也就是该文件从来没有被读入内存的情况），则会通过mmap()建立的映射关系，从硬 盘上将文件读取到物理内存中，如图1中过程3所示。&nbsp;<br/>3.如果在拷贝数据时，发现物理内存不够用，则会通过虚拟内存机制（swap）将暂时不用的物理页面交换到硬盘上，如图1中过程4所示。</p><h3 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>内存映射文件的效率</h3><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">了解过内存映射文件都知道,它比传统的IO读写数据快很多,那么,它为什么会这么快,从代码层面上来看,从硬盘上将文件读入内存,都是要经过数据拷贝,并且数据拷贝操作是由文件系统和硬件驱动实现的，理论上来说，拷贝数据的效率是一 样的。其实,原因是read()是系统调用，其中进行了数据 拷贝，它首先将文件内容从硬盘拷贝到内核空间的一个缓冲区，如图2中过程1，然后再将这些数据拷贝到用户空间，如图2中过程2，在这个过程中，实际上完成 了两次数据拷贝 ；而mmap()也是系统调用，如前所述，mmap()中没有进行数据拷贝，真正的数据拷贝是在缺页中断处理时进行的，由于mmap()将文件直接映射到用户空间，所以中断处理函数根据这个映射关系，直接将文件从硬盘拷贝到用户空间，只进行了 一次数据拷贝 。因此，内存映射的效率要比read/write效率高。&nbsp;<br/><img src=\"/ueditor/jsp/upload/image/20161127/1480261204403066187.gif\" alt=\"这里写图片描述\" title=\"\"/></p><pre style=\"white-space: pre-wrap; word-wrap: break-word; box-sizing: border-box; margin-top: 0px; margin-bottom: 10.5px; font-family: &#39;Source Code Pro&#39;, monospace; padding: 10px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read系统调用原理</pre><h4 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(255, 153, 0); box-sizing: border-box;\"></a>　传统IO和内存映射效率对比.</h4><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">在这里,使用<a href=\"http://lib.csdn.net/base/17\" class=\"replace_word\" title=\"Java EE知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration: none; box-sizing: border-box; font-weight: bold;\">Java</a>传统的IO,加缓冲区的IO,内存映射分别读取10M数据.用时如下:</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">public&nbsp;class&nbsp;MapBufDelete&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;fis=new&nbsp;FileInputStream(&quot;./largeFile.txt&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;sum=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t1=System.currentTimeMillis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while((n=fis.read())&gt;=0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;数据处理\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t=System.currentTimeMillis()-t1;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;传统IOread文件,不使用缓冲区,用时:&quot;+t);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(FileNotFoundException&nbsp;e)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;fis=new&nbsp;FileInputStream(&quot;./largeFile.txt&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedInputStream&nbsp;bis=new&nbsp;BufferedInputStream(fis);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;sum=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t1=System.currentTimeMillis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while((n=bis.read())&gt;=0){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;数据处理\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t=System.currentTimeMillis()-t1;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;传统IOread文件,使用缓冲区,用时:&quot;+t);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(FileNotFoundException&nbsp;e)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MappedByteBuffer&nbsp;buffer=null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer=new&nbsp;RandomAccessFile(&quot;./largeFile.txt&quot;,&quot;rw&quot;).getChannel().map(FileChannel.MapMode.READ_WRITE,&nbsp;0,&nbsp;1253244);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;sum=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t1=System.currentTimeMillis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(int&nbsp;i=0;i&lt;1024*1024*10;i++){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;数据处理\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;t=System.currentTimeMillis()-t1;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;内存映射文件读取文件,用时:&quot;+t);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(FileNotFoundException&nbsp;e)&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}finally&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061621234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">运行结果</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">传统IOread文件,不使用缓冲区,用时:4739传统IOread文件,使用缓冲区,用时:59内存映射文件读取文件,用时:1112341234</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">最后,解释一下,为什么使用缓冲区读取文件会比不使用快:&nbsp;<br/>原因是每次进行IO操作,都要从用户态陷入内核态,由内核把数据从磁盘中读到内核缓冲区,再由内核缓冲区到用户缓冲区,如果没有buffer，读取都需要从用户态到内核态切换，而这种切换很耗时，所以，采用预读，减少IO次数，如果有buffer,根据局部性原理,就会一次多读数据,放到缓冲区中,减少了IO次数.</p><p><br/></p>','2016-11-27','首先说说这篇文章要解决什么问题? 1.虚拟内存与内存映射文件的区别与联系. 2.内存映射文件的原理. 3.内存映射文件的效率. 4.传统IO和内存映射效率对比.虚拟内存与内存映射文件的区别与联系　二者..',8),(4,1,2,'微信小程序 - 仿果库列表','<p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">这个篇文章带大家一起练练<a href=\"http://lib.csdn.net/base/5\" class=\"replace_word\" title=\"微信开发知识库\" target=\"_blank\" style=\"color: rgb(223, 52, 52); text-decoration: none; box-sizing: border-box; font-weight: bold;\">微信</a>小程序布局。</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">下面将会按照以下的顺序介绍：</p><ol style=\"box-sizing: border-box; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\" class=\" list-paddingleft-2\"><li><p><strong style=\"box-sizing: border-box;\">布局的实现</strong></p></li><li><p><strong style=\"box-sizing: border-box;\">逻辑的实现</strong></p></li><li><p><strong style=\"box-sizing: border-box;\">样式的实现</strong></p></li></ol><h2 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(51, 102, 153); box-sizing: border-box;\"></a>1.布局的实现</h2><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">最大的布局是view， view布局中包含了：一张图片，文字描述，信息栏和分界线</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&lt;!--最外层--&gt;&lt;view&nbsp;class=&quot;home-view1&quot;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--图片层--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view2&quot;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;image&nbsp;&nbsp;class=&quot;home-image1&quot;&nbsp;src=&quot;http://qty83k.creatby.com/materials/origin/640e31829b8776967dedc670b5427d0f_origin.jpg&quot;&gt;&lt;/image&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--描述层--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text1&quot;&gt;小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物&lt;/text&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--信息层--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view3&quot;&gt;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;&nbsp;class=&quot;home-view4&quot;&nbsp;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;image&nbsp;&nbsp;class=&quot;home-image-heart&quot;&nbsp;src=&quot;http://qty83k.creatby.com/materials/origin/c5656ef00d38d89eae437c5a9102f8fa_origin.png&quot;&gt;&lt;/image&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text-heart&nbsp;bgColor&quot;&nbsp;&gt;&nbsp;22&lt;/text&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text-time&quot;&nbsp;&gt;2016.10.29&lt;/text&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--分界线line--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view-line&quot;&gt;&lt;/view&gt;\n\n\n\n\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--图片层(下面的代码直接复制了上面的所有布局代码)--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view2&quot;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;image&nbsp;&nbsp;class=&quot;home-image1&quot;&nbsp;src=&quot;http://qty83k.creatby.com/materials/origin/640e31829b8776967dedc670b5427d0f_origin.jpg&quot;&gt;&lt;/image&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--描述层--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text1&quot;&gt;小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物小巧可爱的案头雅物&lt;/text&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--信息层--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view3&quot;&gt;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;&nbsp;class=&quot;home-view4&quot;&nbsp;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;image&nbsp;&nbsp;class=&quot;home-image-heart&quot;&nbsp;src=&quot;http://qty83k.creatby.com/materials/origin/c5656ef00d38d89eae437c5a9102f8fa_origin.png&quot;&gt;&lt;/image&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text-heart&nbsp;bgColor&quot;&nbsp;&gt;&nbsp;22&lt;/text&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&nbsp;class=&quot;home-text-time&quot;&nbsp;&gt;2016.10.29&lt;/text&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;/view&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--分界线line--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;view&nbsp;class=&quot;home-view-line&quot;&gt;&lt;/view&gt;&lt;/view&gt;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051</pre><h2 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(51, 102, 153); box-sizing: border-box;\"></a>2.逻辑的实现</h2><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">只是注册了Page界面</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">Page({&nbsp;&nbsp;&nbsp;&nbsp;data:{&nbsp;&nbsp;&nbsp;&nbsp;}\n\n})12345671234567</pre><h2 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(51, 102, 153); box-sizing: border-box;\"></a>3.样式的实现</h2><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-view1样式：display规定最大View布局为弹性布局，justify-content规定内容居中，竖直排列, …</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-view3样式：display规定了信息栏布局为弹性布局，justify-content规定内容水平平均分配</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-view4样式：display规定了收藏图片和收藏数的父布局为弹性布局，align-items规定内容在竖直方向居中</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-image1样式：规定图片的高度</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-image-heart样式：规定收藏图片的大小</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-text1样式：规定描述文字的样式，text-align规定文字居中，line-height规定两行文字之间的高度</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-text-heart样式：规定收藏数的样式，border-radius规定边界圆角</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.home-view-line样式：是一条分界线</p><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\">.bgColor样式：规定收藏数的背景</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">.home-view1{&nbsp;&nbsp;&nbsp;&nbsp;display:&nbsp;flex;&nbsp;&nbsp;&nbsp;&nbsp;justify-content:&nbsp;center;&nbsp;&nbsp;&nbsp;&nbsp;flex-direction:&nbsp;column;&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;100%;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;100%;&nbsp;&nbsp;&nbsp;&nbsp;margin:&nbsp;6px;}.home-view3{&nbsp;&nbsp;&nbsp;&nbsp;display:&nbsp;flex;&nbsp;&nbsp;&nbsp;&nbsp;justify-content:&nbsp;space-between;}.home-view4{&nbsp;&nbsp;&nbsp;&nbsp;display:&nbsp;flex;&nbsp;&nbsp;&nbsp;&nbsp;align-items:&nbsp;center;}.home-image1{&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;200px;}.home-image-heart{&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;30px;&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;30px;}.home-text1{&nbsp;&nbsp;&nbsp;&nbsp;text-align:&nbsp;left;&nbsp;&nbsp;&nbsp;&nbsp;line-height:&nbsp;25px;&nbsp;&nbsp;&nbsp;&nbsp;margin-top:&nbsp;6px;&nbsp;&nbsp;&nbsp;&nbsp;margin-right:&nbsp;6px;&nbsp;&nbsp;&nbsp;&nbsp;color:&nbsp;gray;}.home-text-heart{&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;22px;&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;22px;&nbsp;&nbsp;&nbsp;&nbsp;margin-left:&nbsp;10px;&nbsp;&nbsp;&nbsp;&nbsp;border-radius:&nbsp;20%;&nbsp;&nbsp;&nbsp;&nbsp;pad:&nbsp;5px;&nbsp;&nbsp;&nbsp;&nbsp;text-align:&nbsp;center;}.home-text-time{&nbsp;&nbsp;&nbsp;&nbsp;text-align:&nbsp;center;&nbsp;&nbsp;&nbsp;&nbsp;margin-right:&nbsp;20px;&nbsp;&nbsp;&nbsp;&nbsp;padding-top:&nbsp;5px;&nbsp;&nbsp;&nbsp;&nbsp;color:&nbsp;gray;}.home-view-line{&nbsp;width:&nbsp;100%;&nbsp;height:&nbsp;6px;&nbsp;margin-top:&nbsp;5px;&nbsp;background-color:&nbsp;gainsboro;}.bgColor{&nbsp;&nbsp;&nbsp;&nbsp;background-color:&nbsp;lightblue;&nbsp;&nbsp;&nbsp;&nbsp;opacity:&nbsp;0.6;}123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566</pre><h2 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"color: rgb(51, 102, 153); box-sizing: border-box;\"></a>4.效果图</h2><p style=\"box-sizing: border-box; margin-top: 0px; margin-bottom: 1.1em; color: rgb(51, 51, 51); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 26px; white-space: normal; background-color: rgb(255, 255, 255);\"><img src=\"/ueditor/jsp/upload/image/20161127/1480261920855083394.gif\" alt=\"\" title=\"\"/></p><p><br/></p>','2016-11-27','这个篇文章带大家一起练练微信小程序布局。下面将会按照以下的顺序介绍：布局的实现逻辑的实现样式的实现1.布局的实现最大的布局是view， view布局中包含了：一张图片，文字描述，信息栏和分界线<!--..',2),(6,1,3,'开发一个android桌面','<p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">要开发一个自己的桌面，作为程序员，觉得好多的应用都在偷偷的跑流量。&nbsp;<br/>开发一个桌面程序，然后常驻系统服务，定时检查服务。&nbsp;<br/>对系统的其他应用网络进行监控。把一些常用的功能集成进来。&nbsp;<br/>做一个讯飞的语音服务。实现一些简单的人机交互。&nbsp;<br/>参考一个哥们写的：&nbsp;<br/><a href=\"http://blog.csdn.net/sljjyy/article/details/11927713\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/sljjyy/article/details/11927713</a></p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>2，修改配置文件</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">在AndroidManifest.xml 配置文件中增加两行即可。</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;activity&nbsp;android:name=&quot;.MainActivity&quot;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;intent-filter&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;增加lancher配置--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.HOME&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.DEFAULT&quot;&nbsp;/&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;action&nbsp;android:name=&quot;android.intent.action.MAIN&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.LAUNCHER&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/intent-filter&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/activity&gt;1234567891012345678910</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">然后这个默认的activity程序就成桌面了。按home的时候。&nbsp;<br/>会弹出一个选择框选择桌面。&nbsp;<br/><img src=\"/ueditor/jsp/upload/image/20161127/1480262373362021384.png\" alt=\"\" title=\"\"/></p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>3，进行优化</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">查询全部app</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">Intent&nbsp;mainIntent&nbsp;=&nbsp;new&nbsp;Intent(Intent.ACTION_MAIN,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ImageView(MainActivity.this);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apps&nbsp;=&nbsp;getPackageManager().queryIntentActivities(mainIntent,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(apps&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ResolveInfo&nbsp;resolveInfo&nbsp;:&nbsp;apps)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.v(TAG,&nbsp;resolveInfo.toString());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}1234567891012345678910</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">把返回的app显示到主界面中。&nbsp;<br/>实现一个BaseAdapter 类。实现getView 方法。</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;View&nbsp;convertView&nbsp;=&nbsp;LayoutInflater.from(mContent).inflate(R.layout.text_img_view,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageView&nbsp;image&nbsp;=&nbsp;(ImageView)&nbsp;convertView.findViewById(R.id.image);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextView&nbsp;text&nbsp;=&nbsp;(TextView)&nbsp;convertView.findViewById(R.id.text);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置文字和图片。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text.setText(info.loadLabel(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.setImageDrawable(info.activityInfo.loadIcon(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;convertView.setScaleType(ImageView.ScaleType.FIT_CENTER);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//使用dp进行参数设置。进行分辨率适配。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertView.setLayoutParams(new&nbsp;GridView.LayoutParams(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_width),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_height)));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回一个图文混合。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;convertView;123456789101112131415161718123456789101112131415161718</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">定义了一个layout</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;utf-8&quot;?&gt;&lt;LinearLayout&nbsp;xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:orientation=&quot;vertical&quot;&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;ImageView&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=&quot;@+id/image&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;50dp&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;50dp&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_gravity=&quot;center_horizontal&quot;&nbsp;/&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;TextView&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=&quot;@+id/text&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;wrap_content&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:gravity=&quot;center&quot;&nbsp;/&gt;&lt;/LinearLayout&gt;1234567891011121314151617181912345678910111213141516171819</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">上面是图片，下面是文字。&nbsp;<br/>还定义了宽度和高度</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&lt;resources&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;dimen&nbsp;name=&quot;app_width&quot;&gt;90dp&lt;/dimen&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;dimen&nbsp;name=&quot;app_height&quot;&gt;90dp&lt;/dimen&gt;&lt;/resources&gt;12341234</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">运行效果：&nbsp;<br/><img src=\"/ueditor/jsp/upload/image/20161127/1480262373408062367.png\" alt=\"\" title=\"\"/>&nbsp;<br/>很接近了。&nbsp;<br/>最后在设置下打开。壁纸啥的。就都一样了。</p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>4，全部代码</h1><hr/><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">package&nbsp;com.demo.lanchertest;import&nbsp;android.content.ComponentName;import&nbsp;android.content.Context;import&nbsp;android.content.Intent;import&nbsp;android.content.pm.ResolveInfo;import&nbsp;android.content.res.Resources;import&nbsp;android.net.Uri;import&nbsp;android.support.v7.app.AppCompatActivity;import&nbsp;android.os.Bundle;import&nbsp;android.util.Log;import&nbsp;android.view.LayoutInflater;import&nbsp;android.view.View;import&nbsp;android.view.ViewGroup;import&nbsp;android.widget.AbsListView;import&nbsp;android.widget.AdapterView;import&nbsp;android.widget.BaseAdapter;import&nbsp;android.widget.GridView;import&nbsp;android.widget.ImageView;import&nbsp;android.widget.TextView;import&nbsp;com.google.android.gms.appindexing.Action;import&nbsp;com.google.android.gms.appindexing.AppIndex;import&nbsp;com.google.android.gms.appindexing.Thing;import&nbsp;com.google.android.gms.common.api.GoogleApiClient;import&nbsp;java.security.AccessControlContext;import&nbsp;java.util.List;import&nbsp;static&nbsp;java.security.AccessController.getContext;public&nbsp;class&nbsp;MainActivity&nbsp;extends&nbsp;AppCompatActivity&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;TAG&nbsp;=&nbsp;&quot;Lancher&quot;;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;onCreate(Bundle&nbsp;savedInstanceState)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.onCreate(savedInstanceState);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setContentView(R.layout.activity_main);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//加载app应用。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loadApps();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GridView&nbsp;gridView&nbsp;=&nbsp;(GridView)&nbsp;findViewById(R.id.apps_list);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置默认适配器。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mContent&nbsp;=&nbsp;getApplicationContext();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mResources&nbsp;=&nbsp;getResources();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gridView.setAdapter(new&nbsp;AppsAdapter());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gridView.setOnItemClickListener(clickListener);\n\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AdapterView.OnItemClickListener&nbsp;clickListener&nbsp;=&nbsp;new&nbsp;AdapterView.OnItemClickListener()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onItemClick(AdapterView&lt;?&gt;&nbsp;adapterView,&nbsp;View&nbsp;view,&nbsp;int&nbsp;i,&nbsp;long&nbsp;l)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//该应用的包名\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;pkg&nbsp;=&nbsp;info.activityInfo.packageName;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//应用的主activity类\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cls&nbsp;=&nbsp;info.activityInfo.name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ComponentName&nbsp;componet&nbsp;=&nbsp;new&nbsp;ComponentName(pkg,&nbsp;cls);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent&nbsp;intent&nbsp;=&nbsp;new&nbsp;Intent();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent.setComponent(componet);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startActivity(intent);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;List&lt;ResolveInfo&gt;&nbsp;apps;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Resources&nbsp;mResources;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Context&nbsp;mContent;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;loadApps()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent&nbsp;mainIntent&nbsp;=&nbsp;new&nbsp;Intent(Intent.ACTION_MAIN,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ImageView(MainActivity.this);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apps&nbsp;=&nbsp;getPackageManager().queryIntentActivities(mainIntent,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(apps&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ResolveInfo&nbsp;resolveInfo&nbsp;:&nbsp;apps)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.v(TAG,&nbsp;resolveInfo.toString());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;AppsAdapter&nbsp;extends&nbsp;BaseAdapter&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AppsAdapter()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;getCount()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;apps.size();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getItem(int&nbsp;i)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;apps.get(i);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;long&nbsp;getItemId(int&nbsp;i)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;View&nbsp;getView(int&nbsp;i,&nbsp;View&nbsp;view,&nbsp;ViewGroup&nbsp;viewGroup)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;View&nbsp;convertView&nbsp;=&nbsp;LayoutInflater.from(mContent).inflate(R.layout.text_img_view,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageView&nbsp;image&nbsp;=&nbsp;(ImageView)&nbsp;convertView.findViewById(R.id.image);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextView&nbsp;text&nbsp;=&nbsp;(TextView)&nbsp;convertView.findViewById(R.id.text);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置文字和图片。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text.setText(info.loadLabel(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.setImageDrawable(info.activityInfo.loadIcon(getPackageManager()));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;convertView.setScaleType(ImageView.ScaleType.FIT_CENTER);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//使用dp进行参数设置。进行分辨率适配。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertView.setLayoutParams(new&nbsp;GridView.LayoutParams(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_width),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_height)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回一个图文混合。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;convertView;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">全部代码不过130 行。但是很有意思。</p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>5，总结</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">本文的原文连接是:&nbsp;<a href=\"http://blog.csdn.net/freewebsys/article/details/53363731\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/freewebsys/article/details/53363731</a>&nbsp;未经博主允许不得转载。&nbsp;<br/>博主地址是：<a href=\"http://blog.csdn.net/freewebsys\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/freewebsys</a></p><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">开发一个自定义桌面还是挺有意思的。&nbsp;<br/>想咋控制就咋控制呢。一页显示多少app，文字大小，图标。</p><p><br/></p>','2016-11-27','要开发一个自己的桌面，作为程序员，觉得好多的应用都在偷偷的跑流量。 开发一个桌面程序，然后常驻系统服务，定时检查服务。 对系统的其他应用网络进行监控。把一些常用的功能集成进来。 做一个讯飞的语音服务。..',0),(7,1,3,'开发一个android桌面','<p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">要开发一个自己的桌面，作为程序员，觉得好多的应用都在偷偷的跑流量。&nbsp;<br/>开发一个桌面程序，然后常驻系统服务，定时检查服务。&nbsp;<br/>对系统的其他应用网络进行监控。把一些常用的功能集成进来。&nbsp;<br/>做一个讯飞的语音服务。实现一些简单的人机交互。&nbsp;<br/>参考一个哥们写的：&nbsp;<br/><a href=\"http://blog.csdn.net/sljjyy/article/details/11927713\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/sljjyy/article/details/11927713</a></p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>2，修改配置文件</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">在AndroidManifest.xml 配置文件中增加两行即可。</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;activity&nbsp;android:name=&quot;.MainActivity&quot;&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;intent-filter&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;增加lancher配置--&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.HOME&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.DEFAULT&quot;&nbsp;/&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;action&nbsp;android:name=&quot;android.intent.action.MAIN&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&nbsp;android:name=&quot;android.intent.category.LAUNCHER&quot;&nbsp;/&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/intent-filter&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/activity&gt;1234567891012345678910</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">然后这个默认的activity程序就成桌面了。按home的时候。&nbsp;<br/>会弹出一个选择框选择桌面。&nbsp;<br/><img src=\"/ueditor/jsp/upload/image/20161127/1480262373362021384.png\" alt=\"\" title=\"\"/></p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>3，进行优化</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">查询全部app</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">Intent&nbsp;mainIntent&nbsp;=&nbsp;new&nbsp;Intent(Intent.ACTION_MAIN,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ImageView(MainActivity.this);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apps&nbsp;=&nbsp;getPackageManager().queryIntentActivities(mainIntent,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(apps&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ResolveInfo&nbsp;resolveInfo&nbsp;:&nbsp;apps)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.v(TAG,&nbsp;resolveInfo.toString());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}1234567891012345678910</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">把返回的app显示到主界面中。&nbsp;<br/>实现一个BaseAdapter 类。实现getView 方法。</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;View&nbsp;convertView&nbsp;=&nbsp;LayoutInflater.from(mContent).inflate(R.layout.text_img_view,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageView&nbsp;image&nbsp;=&nbsp;(ImageView)&nbsp;convertView.findViewById(R.id.image);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextView&nbsp;text&nbsp;=&nbsp;(TextView)&nbsp;convertView.findViewById(R.id.text);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置文字和图片。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text.setText(info.loadLabel(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.setImageDrawable(info.activityInfo.loadIcon(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;convertView.setScaleType(ImageView.ScaleType.FIT_CENTER);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//使用dp进行参数设置。进行分辨率适配。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertView.setLayoutParams(new&nbsp;GridView.LayoutParams(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_width),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_height)));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回一个图文混合。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;convertView;123456789101112131415161718123456789101112131415161718</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">定义了一个layout</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;utf-8&quot;?&gt;&lt;LinearLayout&nbsp;xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;android:orientation=&quot;vertical&quot;&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;ImageView&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=&quot;@+id/image&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;50dp&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;50dp&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_gravity=&quot;center_horizontal&quot;&nbsp;/&gt;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;TextView&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=&quot;@+id/text&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=&quot;match_parent&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=&quot;wrap_content&quot;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:gravity=&quot;center&quot;&nbsp;/&gt;&lt;/LinearLayout&gt;1234567891011121314151617181912345678910111213141516171819</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">上面是图片，下面是文字。&nbsp;<br/>还定义了宽度和高度</p><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">&lt;resources&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;dimen&nbsp;name=&quot;app_width&quot;&gt;90dp&lt;/dimen&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;dimen&nbsp;name=&quot;app_height&quot;&gt;90dp&lt;/dimen&gt;&lt;/resources&gt;12341234</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">运行效果：&nbsp;<br/><img src=\"/ueditor/jsp/upload/image/20161127/1480262373408062367.png\" alt=\"\" title=\"\"/>&nbsp;<br/>很接近了。&nbsp;<br/>最后在设置下打开。壁纸啥的。就都一样了。</p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>4，全部代码</h1><hr/><pre class=\"prettyprint\" style=\"white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: &#39;Source Code Pro&#39;, monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 1px solid rgba(128, 128, 128, 0.0745098); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);\">package&nbsp;com.demo.lanchertest;import&nbsp;android.content.ComponentName;import&nbsp;android.content.Context;import&nbsp;android.content.Intent;import&nbsp;android.content.pm.ResolveInfo;import&nbsp;android.content.res.Resources;import&nbsp;android.net.Uri;import&nbsp;android.support.v7.app.AppCompatActivity;import&nbsp;android.os.Bundle;import&nbsp;android.util.Log;import&nbsp;android.view.LayoutInflater;import&nbsp;android.view.View;import&nbsp;android.view.ViewGroup;import&nbsp;android.widget.AbsListView;import&nbsp;android.widget.AdapterView;import&nbsp;android.widget.BaseAdapter;import&nbsp;android.widget.GridView;import&nbsp;android.widget.ImageView;import&nbsp;android.widget.TextView;import&nbsp;com.google.android.gms.appindexing.Action;import&nbsp;com.google.android.gms.appindexing.AppIndex;import&nbsp;com.google.android.gms.appindexing.Thing;import&nbsp;com.google.android.gms.common.api.GoogleApiClient;import&nbsp;java.security.AccessControlContext;import&nbsp;java.util.List;import&nbsp;static&nbsp;java.security.AccessController.getContext;public&nbsp;class&nbsp;MainActivity&nbsp;extends&nbsp;AppCompatActivity&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;final&nbsp;String&nbsp;TAG&nbsp;=&nbsp;&quot;Lancher&quot;;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;onCreate(Bundle&nbsp;savedInstanceState)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.onCreate(savedInstanceState);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setContentView(R.layout.activity_main);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//加载app应用。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loadApps();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GridView&nbsp;gridView&nbsp;=&nbsp;(GridView)&nbsp;findViewById(R.id.apps_list);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置默认适配器。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mContent&nbsp;=&nbsp;getApplicationContext();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mResources&nbsp;=&nbsp;getResources();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gridView.setAdapter(new&nbsp;AppsAdapter());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gridView.setOnItemClickListener(clickListener);\n\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;AdapterView.OnItemClickListener&nbsp;clickListener&nbsp;=&nbsp;new&nbsp;AdapterView.OnItemClickListener()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;onItemClick(AdapterView&lt;?&gt;&nbsp;adapterView,&nbsp;View&nbsp;view,&nbsp;int&nbsp;i,&nbsp;long&nbsp;l)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//该应用的包名\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;pkg&nbsp;=&nbsp;info.activityInfo.packageName;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//应用的主activity类\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cls&nbsp;=&nbsp;info.activityInfo.name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ComponentName&nbsp;componet&nbsp;=&nbsp;new&nbsp;ComponentName(pkg,&nbsp;cls);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent&nbsp;intent&nbsp;=&nbsp;new&nbsp;Intent();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent.setComponent(componet);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;startActivity(intent);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;List&lt;ResolveInfo&gt;&nbsp;apps;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Resources&nbsp;mResources;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;Context&nbsp;mContent;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;loadApps()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Intent&nbsp;mainIntent&nbsp;=&nbsp;new&nbsp;Intent(Intent.ACTION_MAIN,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ImageView(MainActivity.this);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apps&nbsp;=&nbsp;getPackageManager().queryIntentActivities(mainIntent,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(apps&nbsp;!=&nbsp;null)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ResolveInfo&nbsp;resolveInfo&nbsp;:&nbsp;apps)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.v(TAG,&nbsp;resolveInfo.toString());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;AppsAdapter&nbsp;extends&nbsp;BaseAdapter&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;AppsAdapter()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;getCount()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;apps.size();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Object&nbsp;getItem(int&nbsp;i)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;apps.get(i);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;long&nbsp;getItemId(int&nbsp;i)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;View&nbsp;getView(int&nbsp;i,&nbsp;View&nbsp;view,&nbsp;ViewGroup&nbsp;viewGroup)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResolveInfo&nbsp;info&nbsp;=&nbsp;apps.get(i);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;View&nbsp;convertView&nbsp;=&nbsp;LayoutInflater.from(mContent).inflate(R.layout.text_img_view,&nbsp;null);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageView&nbsp;image&nbsp;=&nbsp;(ImageView)&nbsp;convertView.findViewById(R.id.image);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextView&nbsp;text&nbsp;=&nbsp;(TextView)&nbsp;convertView.findViewById(R.id.text);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置文字和图片。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text.setText(info.loadLabel(getPackageManager()));\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image.setImageDrawable(info.activityInfo.loadIcon(getPackageManager()));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;convertView.setScaleType(ImageView.ScaleType.FIT_CENTER);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//使用dp进行参数设置。进行分辨率适配。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convertView.setLayoutParams(new&nbsp;GridView.LayoutParams(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_width),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int)&nbsp;mResources.getDimension(R.dimen.app_height)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回一个图文混合。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;convertView;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129</pre><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">全部代码不过130 行。但是很有意思。</p><h1 style=\"margin: 0.8em 0px; padding: 0px; box-sizing: border-box; font-weight: 100; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><a style=\"box-sizing: border-box; color: rgb(12, 137, 207);\"></a>5，总结</h1><hr/><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">本文的原文连接是:&nbsp;<a href=\"http://blog.csdn.net/freewebsys/article/details/53363731\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/freewebsys/article/details/53363731</a>&nbsp;未经博主允许不得转载。&nbsp;<br/>博主地址是：<a href=\"http://blog.csdn.net/freewebsys\" style=\"text-decoration: none; box-sizing: border-box; color: rgb(12, 137, 207);\">http://blog.csdn.net/freewebsys</a></p><p style=\"margin-top: 0px; margin-bottom: 1.1em; padding: 0px; box-sizing: border-box; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 14px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\">开发一个自定义桌面还是挺有意思的。&nbsp;<br/>想咋控制就咋控制呢。一页显示多少app，文字大小，图标。</p><p><br/></p>','2016-11-28','要开发一个自己的桌面，作为程序员，觉得好多的应用都在偷偷的跑流量。 开发一个桌面程序，然后常驻系统服务，定时检查服务。 对系统的其他应用网络进行监控。把一些常用的功能集成进来。 做一个讯飞的语音服务。..',0),(8,1,3,' 微信小程序开发之录音机 音频播放 动画 (真机可用)','<p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">趁着周末用<a href=\"http://lib.csdn.net/base/5\" class=\"replace_word\" title=\"微信开发知识库\" target=\"_blank\" style=\"text-decoration: none; color: rgb(223, 52, 52); font-weight: bold;\">微信</a>小程序做了个简易录音机.跟大家分享,欢迎批评!</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">老规矩,先几张图.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">1.为了进来看得清楚.刚开始没有加载音频列表.代码往前挪一挪即可.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262519822091419.png\" alt=\"\"/><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">2.按住 录音按钮的时候会出现麦克风.中间的麦克风是个帧动画.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">其实就是用js控制图片显示隐藏.没啥好说的.这里值得说一说的是录音.微信的录音API后,如果录音时间太短,会录音失败.所以fail的时候还是需要处理一下.录音时间的限制和微信语音是一样的.60秒.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262519983065736.png\" alt=\"\"/><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">3.我在录音完成后才加载列表.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">下图就是从微信存储的文件里获取到的列表信息.有储存路径,创建时间,文件大小.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">这里的文件可能不只是音频.这里我没做判断.下面的路径都是wx:file//store_...</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">我也去找了下.在Tencent/micromsg/wxafiles/wx..../这一级目录就能找到了.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">时间是格式化之后的.文件大小是B,转成KB如下.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262520042085401.png\" alt=\"\"/><br/></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">手机目录如下.但是打开之后播放不了.目前原因不明.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262520374068326.png\" alt=\"\"/><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">下面是文件全名称.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">1.tempFilePath : 录音之后的临时文件.第二次进入小程序就不能正常使用了.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">2.savedFilePath :持久保存的文件路径.值得注意的是微信只给100M的储存空间.还是尽早上传到后台吧.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262520936052913.png\" alt=\"\"/><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><br/></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">4.播放录音音频.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">点击item就能听到你的声音了.别被自己吓住.哈哈.</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262521995046232.png\" alt=\"\"/><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">上代码:</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\">1.index.wxml</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"></span></p><p><strong>[html]</strong>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_plain.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_copy.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">copy</a>&nbsp;<span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262523845074120.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-xml list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comments\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">&lt;!--index.wxml--&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">scroll-view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{voices}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;common-list&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">style</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;margin-bottom:120rpx;&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">block</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:for</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{voices}}&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;board&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;cell&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;cell-bd&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">data-key</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{item.filePath}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">bindtap</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;gotoPlay&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;date&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">存储路径:{{item.filePath}}</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;date&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">存储时间:{{item.createTime}}</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;date&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">音频大小:{{item.size}}KB</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">block</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">scroll-view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{isSpeaking}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;speak-style&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;sound-style&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">src</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;../../images/voice_icon_speech_sound_1.png&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{j==2}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;sound-style&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">src</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;../../images/voice_icon_speech_sound_2.png&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{j==3}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;sound-style&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">src</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;../../images/voice_icon_speech_sound_3.png&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;{{j==4}}&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;sound-style&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">src</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;../../images/voice_icon_speech_sound_4.png&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">wx:if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=&quot;{{j==5}}&quot;</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=&quot;sound-style&quot;&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">src</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;../../images/voice_icon_speech_sound_5.png&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">image</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;record-style&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">button</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">class</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;btn-style&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">bindtouchstart</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;touchdown&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"attribute\" style=\"margin: 0px; padding: 0px; border: none; color: red; background-color: inherit;\">bindtouchend</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">=</span><span class=\"attribute-value\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;touchup&quot;</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">按住&nbsp;录音</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">button</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;<span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&lt;/</span><span class=\"tag-name\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">view</span><span class=\"tag\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(153, 51, 0); font-weight: bold; background-color: inherit;\">&gt;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li></ol><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><br/></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><br/></span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"><br/></span></p><p><span style=\"color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; background-color: rgb(255, 255, 255);\">2.index.wxss</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"></span></p><p><strong>[css]</strong>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_plain.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_copy.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">copy</a>&nbsp;<span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262523845074120.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-css list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">/**index.wxss**/</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.speak-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">position</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">relative</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">height</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">240</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">width</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">240</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;border-radius:&nbsp;<span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">20</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">50%</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">auto</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">background</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">#26A5FF</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.item-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-top</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">30</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-bottom</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">30</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.text-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">text-align</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">center</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.record-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">position</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">fixed</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;bottom:&nbsp;<span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">0</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;left:&nbsp;<span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">0</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">height</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">120</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">width</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">100%</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.btn-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-left</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">30</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-right</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">30</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.sound-style{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">position</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">absolute</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">width</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">74</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">height</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">150</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-top</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">45</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-left</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">83</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.board&nbsp;{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">overflow</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">hidden</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">border-bottom</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">2</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">solid</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">#26A5FF</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">/*列布局*/</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.cell{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">display</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;flex;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">20</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.cell-hd{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">margin-left</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">10</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">color</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">#885A38</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.cell&nbsp;.cell-bd{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;flex:<span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">1</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">position</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">relative</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">/**只显示一行*/</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">.date{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">font-size</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">30</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">rpx;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;text-<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">overflow</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:&nbsp;ellipsis;&nbsp;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">white-space</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">nowrap</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">overflow</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">:</span><span class=\"value\" style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">hidden</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">}&nbsp;&nbsp;</span></p></li></ol><p><br/><span style=\"color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; background-color: rgb(255, 255, 255);\">3.index.js</span></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><br/></p><p style=\"margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(85, 85, 85); font-family: &#39;microsoft yahei&#39;; font-size: 15px; line-height: 35px; white-space: normal; background-color: rgb(255, 255, 255);\"><span style=\"font-size: 24px;\"></span></p><p><strong>[javascript]</strong>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"ViewSource\" title=\"view plain\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_plain.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">view plain</a>&nbsp;<a href=\"http://blog.csdn.net/qq_31383345/article/details/53358267#\" class=\"CopyToClipboard\" title=\"copy\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; text-indent: -2000px; background-image: url(&quot;images/default/ico_copy.gif&quot;); background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\">copy</a>&nbsp;<span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384\" target=\"_blank\" title=\"在CODE上查看代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"/ueditor/jsp/upload/image/20161128/1480262523845074120.png\" width=\"12\" height=\"12\" alt=\"在CODE上查看代码片\"/></a></span><span class=\"tracking-ad\"><a href=\"https://code.csdn.net/snippets/2010384/fork\" target=\"_blank\" title=\"派生到我的代码片\" style=\"text-decoration: none; border: none; padding: 1px; margin: 0px 10px 0px 0px; font-size: 9px; color: rgb(12, 137, 207); display: inline-block; width: 16px; height: 16px; background-image: none; background-attachment: initial; background-color: inherit; background-size: initial; background-origin: initial; background-clip: initial; background-position: 0% 0%; background-repeat: no-repeat;\"><img src=\"https://code.csdn.net/assets/ico_fork.svg\" width=\"12\" height=\"12\" alt=\"派生到我的代码片\"/></a></span></p><ol class=\"dp-c list-paddingleft-2\" style=\"padding: 0px; border: none; color: rgb(92, 92, 92); margin-bottom: 1px !important; margin-left: 45px !important; background-color: rgb(255, 255, 255);\"><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//index.js</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//获取应用实例</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;app&nbsp;=&nbsp;getApp()&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">Page({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;data:&nbsp;{&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;j:&nbsp;1,<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//帧动画初始图片</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;isSpeaking:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">false</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,</span><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//是否正在说话</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;voices:&nbsp;[],<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//音频数组</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;},&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;onLoad:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;},&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//手指按下</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;touchdown:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;手指按下了...&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;new&nbsp;date&nbsp;:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">new</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Date)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;_this&nbsp;=&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;speaking.call(<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">);&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">.setData({&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isSpeaking:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">true</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//开始录音</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;wx.startRecord({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//临时路径,下次进入小程序时无法正常使用</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;tempFilePath&nbsp;=&nbsp;res.tempFilePath&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;tempFilePath:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;tempFilePath)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//持久保存</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.saveFile({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tempFilePath:&nbsp;tempFilePath,&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//持久路径</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//本地文件存储的大小限制为&nbsp;100M</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;savedFilePath&nbsp;=&nbsp;res.savedFilePath&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;savedFilePath:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;savedFilePath)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;恭喜!录音成功&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;icon:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;success&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duration:&nbsp;1000&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//获取录音音频列表</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.getSavedFileList({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;voices&nbsp;=&nbsp;[];&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">for</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;res.fileList.length;&nbsp;i++)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//格式化时间</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;createTime&nbsp;=&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">new</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;Date(res.fileList[i].createTime)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//将音频大小B转为KB</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;size&nbsp;=&nbsp;(res.fileList[i].size&nbsp;/&nbsp;1024).toFixed(2);&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;voice&nbsp;=&nbsp;{&nbsp;filePath:&nbsp;res.fileList[i].filePath,&nbsp;createTime:&nbsp;createTime,&nbsp;size:&nbsp;size&nbsp;};&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;文件路径:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;res.fileList[i].filePath)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;文件时间:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;createTime)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;文件大小:&nbsp;&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;+&nbsp;size)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;voices&nbsp;=&nbsp;voices.concat(voice);&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_this.setData({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;voices:&nbsp;voices&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fail:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//录音失败</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showModal({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;提示&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;录音的姿势不对!&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showCancel:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">false</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">if</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(res.confirm)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;用户点击确定&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">return</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;},&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//手指抬起</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;touchup:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&quot;手指抬起了...&quot;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">.setData({&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isSpeaking:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">false</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;clearInterval(<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">.timer)&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;wx.stopRecord()&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;},&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//点击播放录音</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;gotoPlay:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;(e)&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;filePath&nbsp;=&nbsp;e.currentTarget.dataset.key;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//点击开始播放</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;开始播放&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;icon:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;success&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duration:&nbsp;1000&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;wx.playVoice({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filePath:&nbsp;filePath,&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success:&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wx.showToast({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;播放结束&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;icon:&nbsp;<span class=\"string\" style=\"margin: 0px; padding: 0px; border: none; color: blue; background-color: inherit;\">&#39;success&#39;</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">,&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;duration:&nbsp;1000&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;}&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//麦克风帧动画</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\"><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;speaking()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;_this&nbsp;=&nbsp;</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"comment\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 130, 0); background-color: inherit;\">//话筒帧动画</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">var</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;i&nbsp;=&nbsp;1;&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;<span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">this</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">.timer&nbsp;=&nbsp;setInterval(</span><span class=\"keyword\" style=\"margin: 0px; padding: 0px; border: none; color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;\">function</span><span style=\"margin: 0px; padding: 0px; border: none; background-color: inherit;\">&nbsp;()&nbsp;{&nbsp;&nbsp;</span></span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;i++;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;i&nbsp;%&nbsp;5;&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;_this.setData({&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j:&nbsp;i&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;&nbsp;&nbsp;})&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">&nbsp;&nbsp;},&nbsp;200);&nbsp;&nbsp;</span></p></li><li><p><span style=\"margin: 0px; padding: 0px; border: none; color: black; background-color: inherit;\">} &nbsp;</span></p></li></ol><p><br/></p>','2016-11-28','趁着周末用微信小程序做了个简易录音机.跟大家分享,欢迎批评!老规矩,先几张图.1.为了进来看得清楚.刚开始没有加载音频列表.代码往前挪一挪即可.2.按住 录音按钮的时候会出现麦克风.中间的麦克风是个帧..',1);

/*Table structure for table `reply` */

DROP TABLE IF EXISTS `reply`;

CREATE TABLE `reply` (
  `rid` int(11) NOT NULL AUTO_INCREMENT,
  `pid` int(11) DEFAULT NULL,
  `uid` int(11) DEFAULT NULL,
  `CONTAINER` varchar(255) DEFAULT NULL,
  `REPLYDAY` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`rid`),
  KEY `FK_9okxe7bhernq1aweeives1q8d` (`pid`),
  KEY `FK_pbwi3kwmm97kk97pef504x6j2` (`uid`),
  CONSTRAINT `FK_9okxe7bhernq1aweeives1q8d` FOREIGN KEY (`pid`) REFERENCES `post` (`pid`),
  CONSTRAINT `FK_pbwi3kwmm97kk97pef504x6j2` FOREIGN KEY (`uid`) REFERENCES `user` (`uid`)
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8;

/*Data for the table `reply` */

insert  into `reply`(`rid`,`pid`,`uid`,`CONTAINER`,`REPLYDAY`) values (15,1,3,'sdsd','2016-11-19'),(16,1,3,'sdfsdf','2016-11-19'),(17,3,2,'dsds','2016-11-27');

/*Table structure for table `user` */

DROP TABLE IF EXISTS `user`;

CREATE TABLE `user` (
  `uid` int(11) NOT NULL AUTO_INCREMENT,
  `USERNAME` varchar(255) DEFAULT NULL,
  `EMAIL` varchar(255) DEFAULT NULL,
  `PASSWORD` varchar(255) DEFAULT NULL,
  `STATUS` int(11) DEFAULT NULL,
  `CODE` varchar(255) DEFAULT NULL,
  `USERPHOTO` varchar(255) DEFAULT NULL,
  `INDUSTRY` varchar(255) DEFAULT NULL,
  `JOB` varchar(255) DEFAULT NULL,
  `COUNTRY` varchar(255) DEFAULT NULL,
  `SEX` tinyint(1) DEFAULT NULL,
  `NAME` varchar(255) DEFAULT NULL,
  `BIRTHDAY` varchar(255) DEFAULT NULL,
  `SUMMARY` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`uid`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8;

/*Data for the table `user` */

insert  into `user`(`uid`,`USERNAME`,`EMAIL`,`PASSWORD`,`STATUS`,`CODE`,`USERPHOTO`,`INDUSTRY`,`JOB`,`COUNTRY`,`SEX`,`NAME`,`BIRTHDAY`,`SUMMARY`) values (2,'user','759979592@qq.com','user',1,NULL,'userPhoto/blog.png','IT','跳舞','中国',0,'魏琳洁','1988-12-05',NULL),(3,'admin','admin','admin',1,NULL,'userPhoto/1_romansmith.jpg','ITs','java工程师s','中国s',0,'郑培s','1993-12-29',NULL),(4,'admin1','admin1','8916532',0,'e7215c49ffb74302983f0e5907f2d2da8e8e469a7fac4902ad3c5a6b2492f6c2',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(5,'adminadmin','adminadmin','admin',0,'a5ef05c28e924131b93fc230f299eb590364019ef6b3409cb7b9abc83c8f532e',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL),(6,'admin11','7599795921@qq.com','admin',0,'c450a8fc9ff44e15950a2b10e20f3705d6ee7c88bf874c0bae8ad4352f33d45f',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);

/* Procedure structure for procedure `login` */

/*!50003 DROP PROCEDURE IF EXISTS  `login` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `login`(IN `sdf` int)
BEGIN
	#Routine body goes here...
SELECT * from post where pid=sdf;
END */$$
DELIMITER ;

/* Procedure structure for procedure `logins` */

/*!50003 DROP PROCEDURE IF EXISTS  `logins` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `logins`(IN `p1` int)
BEGIN
	#Routine body goes here...
IF p1=1
THEN SET @sets=20;
ELSE SET @sets=10;
end IF;
SELECT @sets;
SELECT * FROM post;
END */$$
DELIMITER ;

/* Procedure structure for procedure `proc` */

/*!50003 DROP PROCEDURE IF EXISTS  `proc` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `proc`(IN `p1` int)
BEGIN
	#Routine body goes here...
IF p1=1
THEN SET @sets=20;
ELSE SET @sets=10;
end IF;
SELECT @sets;
SELECT * FROM post;
END */$$
DELIMITER ;

/* Procedure structure for procedure `ss` */

/*!50003 DROP PROCEDURE IF EXISTS  `ss` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`localhost` PROCEDURE `ss`(IN `DF` int)
BEGIN
	#Routine body goes here...
SELECT * FROM post where pid=DF;
END */$$
DELIMITER ;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
